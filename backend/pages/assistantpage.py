from __future__ import annotations
from abc import ABC, abstractmethod

from pydantic import BaseModel, create_model, Field

import json

from backend.pages.templates.entity_templates import generate_character_sheet, add_to_character_sheet

from langchain_openai import ChatOpenAI
from langchain_core.output_parsers import JsonOutputParser

import json

from langchain.prompts import PromptTemplate
from langchain.prompts.chat import (
    ChatPromptTemplate,
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate
)

"""
File for all pages for the assistant. Includes entities, metadata, etc.
"""

class Entity(ABC):
    @abstractmethod
    def add_alias(self, new_alias: str):
        """
        Adds an alias for the entity.
        Aliases are any text that refers to the entity.
        """
        raise NotImplementedError("Must be overriden by subclass")
    
    @abstractmethod
    def removes_alias(self, to_remove: str):
        """
        Removes an alias for the entity.
        Aliases are any text that refers to the entity.
        """
        raise NotImplementedError("Must be overriden by subclass")
        
    @abstractmethod
    def reset(self):
        """
        Resets the sheet to square one.
        """
        raise NotImplementedError
    
    @abstractmethod
    def initial_pass(self):
        """
        Does an initial reading of text and creates a character sheet.
        Should only be called once unless reset.
        Raises a runtime error if its already called.
        """
        raise NotImplementedError
    
    @abstractmethod
    def update(self, passages: list[str]):
        """
        Updates the sheet for the specific entity.
        Invokes a specific LLM chain.
        """
        raise NotImplementedError("Must be overriden by subclass")
    
    @abstractmethod
    def as_dict(self) -> dict:
        raise NotImplementedError
    
    @abstractmethod
    def as_json(self) -> str:
        raise NotImplementedError("Must be overridden by subclass")

class Character(Entity):
    """
    An entity representing any character
    """
    def __init__(self, name: str):
        self.name = name
        self.reset()
        
    def add_alias(self, new_alias):
        self.aliases.add(new_alias)
        
    def removes_alias(self, to_remove):
        self.aliases.remove(to_remove)

    def reset(self):
        self.initialized_flag = False
        self.aliases = {self.name}
        self.basic_role: str = "Basic Role:\n To be created. (Call an update to create)"
        self.physical_traits: str = "Physical Traits:\n To be created. (Call an update to create)"
        self.personality_traits: str = "Personality Traits:\n To be created. (Call an update to create)"
        self.stake: str = "Stake:\n To be created. (Call an update to create)"
        self.development: str = "Actions:\n To be created. (Call an update to create)"
        self.relationships: str = "Relationships: To be created. (Call an update to create)"
        
        self.initial_template: ChatPromptTemplate = generate_character_sheet(self.name, self.aliases)
        self.addon_template: ChatPromptTemplate = add_to_character_sheet(self.name, self.aliases)
        self.llm = ChatOpenAI(model='gpt-4o')
        self.parser = JsonOutputParser()
        
        self.initial_chain = self.initial_template | self.llm | self.parser
        self.addon_chain = self.addon_template | self.llm | self.parser


    def initial_pass(self):
        if self.initialized_flag:
            raise RuntimeError("Already initialized")
        
        raise NotImplementedError

    def update(self, passages: list[str]):
        passage_block = ""
        
        if isinstance(passages, list):
            for i in range(len(passages)):
                passage_block += passages[i]
                if i > 0 and i < len(passages) - 1:
                    passage_block += "\n"
                    passage_block += "======================"
                    passage_block += "\n"

                
        if self.initialized_flag:
            result = self.addon_chain.invoke({"passage_block": passage_block, "last_sheet": self.as_json})
            
        else:
            self.initialized_flag = True
            result = self.initial_chain.invoke({"passage_block": passage_block})

        try:
            self.basic_role = result["Basic Role"]
            self.physical_traits = result["Physical Descriptions"]
            self.personality_traits = result["Personality Descriptions"]
            self.stake = result["Stake in the Story"]
            self.development = result["Change/Development"]
            self.relationships = result["Relationships"]
        except Exception as e:
            raise RuntimeError(str(e))
        
        return result

    def as_dict(self) -> dict:
        character_dict = {
                "name": self.name,
                "physical_traits": self.physical_traits,
                "personality_traits": self.personality_traits,
                "actions": self.actions,
                "relationships": self.relationships,
        }
        return character_dict
    
    def as_json(self) -> str:
        return json.dumps(self.as_dict, indent=4)
    
class Setting(Entity):
    """
    An entity representing any location or place in the story.
    """
    def __init__(self, name: str):
        self.name = name
        self.aliases = {name}
        self.basic_role = "To be Created (Call an update to create)"
        self.physical_descriptions = "To be Created (Call an update to create)"
        self.personality_descriptions = "To be Created (Call an update to create)"
        self.stake_in_the_story = "To be Created (Call an update to create)"
        self.change_development = "To be Created (Call an update to create)"
        self.relationships = "To be Created (Call an update to create)"
        
    def add_alias(self, new_alias):
        self.aliases.add(new_alias)
        
    def removes_alias(self, to_remove):
        self.aliases.remove(to_remove)

    def update(self):
        raise NotImplementedError

    def as_dict(self) -> dict:
        setting_dict = {
                "name": self.name,
                "description": self.description,
                "special_traits": self.special_traits,
                "story_relevance": self.story_relevance,
                "general_location": self.general_location
        }
        return setting_dict
    
    def as_json(self) -> str:
        return json.dumps(self.as_dict, indent=4)

class Macro:
    """
    A macro is a word that refers to an entity.
    """
    def __init__(self, text: str, entity: Entity):
        self.text = text
        self.entity = entity
        
    def same_entity(self, other: Macro):
        return self.entity == other.entity
    
if __name__ == "__main__":
    char = Character("Jon")
    
    passage1 = """
    There were times-not many, but a few-when Jon Snow was glad he was a bastard. As he filled his wine cup once more from a passing flagon, it struck him that this might be one of them.He settled back in his place on the bench among the younger squires and drank. The sweet, fruity taste of summerwine   filled his mouth and brought a smile to his lips.  The Great Hall of Winterfell was hazy with smoke and heavy with the smell of roasted meat and fresh-baked bread. Its grey stone walls were draped with banners. White, gold, crimson: the direwolf of Stark, Baratheon’s crowned stag, the lion of Lannister. A singer was playing the high harp and reciting a ballad, but down at this end of the hall his voice could scarcely be heard above the roar of the fire, the clangor of pewter plates and cups, and the low mutter of a hundred drunken conversations.  It was the fourth hour of the welcoming feast laid for the king. Jon’s brothers and sisters had been seated with the royal children, beneath the raised platform where Lord and Lady Stark hosted the king and queen. In honor of the occasion, his lord father would doubtless permit each child a glass of wine, but no more than that. Down here on the benches, there was no one to stop Jon drinking as much as he had a thirst for.  And he was finding that he had a man’s thirst, to the raucous delight of the youths around him, who urged him on every time he drained a glass. They were fine company, and Jon relished the stories they were telling, tales of battle and bedding and the hunt. He was certain that his compa nio ns were more entertaining than the king’s offspring. He had sated his curiosity about the visitors when they made their entrance. The procession had passed not a foot from the place he had been given on the bench, and Jon had gotten a goo d long look at them all.  His lord father had come first, escorting the queen. She was as beautiful as men said. A jeweled tiara gleamed amidst her long golden hair, its emeralds a perfect match for the green of her eyes. His father helped her up the steps to the dais and led her to her seat, but the queen never so much as looked at him. Even at fourteen, Jon could see through her smile.  Next had come King Robert himself, with Lady Stark on his arm. The king was a great disappointment to Jon. His father had talked of him often: the peerless Robert Baratheon, demon of the Trident, the fiercest warrior of the realm, a giant among princes. Jon saw only a fat man, red-faced under his beard, sweating through his silks. He walked like a man half in his cups.  After them came the children. Little Rickon first, managing the long walk with all the dignity a three-year-old could muster. Jon had to urge him on when he stopped to visit. Close behind came Robb, in grey wool trimmed with white, the Stark colors. He had the Princess Myrcella on his arm. She was a wisp of a girl, not quite eight, her hair a cascade of golden curls under a jeweled net. Jon noticed the shy looks she gave Robb as they passed between the tables and the timid way she smiled at him. He decided she was insipid. Robb didn’t even have the sense to realize how stupid she was; he was grinning like a fool.  His half sisters escorted the royal princes. Arya was paired with plump young Tommen, whose white-blond hair was longer than hers. Sansa, two years older, drew the crown prince, Joffrey 
    Baratheon. He was twelve, younger than Jon or Robb, but taller than either, to Jon’s vast dismay. Prince Joffrey had his sister’s hair and his mother’s deep green eyes. A thick tangle of blond curls dripped down past his golden choker and high velvet collar. Sansa looked radiant as she walked beside him, but Jon did not like Joffrey’s pouty lips or the bored, disdainful way he looked at Winterfell’s Great Hall.  He was more interested in the pair that came behind him: the queen’s brothers, the Lannisters of Casterly Rock. The Lion and the Imp; there was no mistaking which was which. Ser Jaime Lannister was twin to Queen Cersei; tall and golden, with flashing green eyes and a smile that cut like a knife. He wore crimson silk, high black boots, a black satin cloak. On the breast of his tunic, the lion of his House was embroidered in gold thread, roaring its defiance. They called him the Lion of Lannister to his face and whispered “Kingslayer”   behind his back.  Jon found it hard to look away from him. This is what a king should look like, he thought to himself as the man passed.  Then he saw the other one, waddling along half-hidden by his brother’s side. Tyrion Lannister, the youngest of Lord Tywin’s brood and by far the ugliest. All that the gods had given to Cersei and Jaime, they had denied Tyrion. He was a dwarf, half his brother’s height, struggling to keep pace on stunted legs. His head was too large for his body, with a brute’s squashed-in face beneath a swollen shelf of brow. One green eye and one black one peered out from under a lank fall o f hair so blond it seemed white. Jon watched hi m wit h fascinat ion.  The last of the high lords to enter were his uncle, Benjen Stark of the Night’s Watch, and his father’s ward, young Theon Greyjoy. Benjen gave Jon a warm smile as he went by. Theon ignored him utterly, but there was nothing new in that. After all had been seated, toasts were made, thanks were given and returned, and then the feasting began.  Jon had started drinking then, and he had not stopped.  Something rubbed against his leg beneath the table. Jon saw red eyes staring up at him. “Hungry again?”   he asked. There was still half a honeyed chicken in the center of the table. Jon reached out to tear off a leg, then had a better idea. He knifed the bird whole and let the carcass slide to the floor between his legs. Ghost ripped into it in savage silence. His brothers and sisters had not been permitted to bring their wolves to the banquet, but there were more curs than Jon could count at this end of the hall, and no one had said a word about his pup.  He told himself he was fortunate in that too.  His eyes stung. Jon rubbed at them savagely, cursing the smoke. He swallowed another gulp of wine and watched his direwolf devour the chicken.  Dogs moved between the tables, trailing after the serving girls. One of them, a black mongrel bitch with long yellow eyes, caught a scent of the chicken. She stopped and edged under the bench to get a share. Jon watched the confrontation. The bitch growled low in her throat and moved closer. Ghost looked up, silent, and fixed the dog with those hot red eyes. The bitch snapped an angry challenge. She was three times the size of the direwolf pup. Ghost did not move. He stood over his prize and opened his mouth, baring his fangs. The bitch tensed, barked 
    again, then thought better of this fight. She turned and slunk away, with one last defiant snap to save her pride. Ghost went back to his meal.  Jon grinned and reached under the table to ruffle the shaggy white fur. The direwolf looked up at him, nipped gently at his hand, then went back to eating.  “  Is this one of the direwolves I’ve heard so much of?”   a familiar voice asked close at hand.  Jon looked up happily as his uncle Ben put a hand on his head and ruffled his hair much as Jon had ruffled the wolf s. “Yes,”   he said. “His name is Ghost.”   One of the squires interrupt ed the bawdy story he’d been telling to make room at the table for their lord’s brother. Benjen Stark straddled the bench with, long legs and took the wine cup out of Jon’s hand. “Summerwine,”   he said after a taste. “Nothing so sweet. How many cups have you had, Jon?”   Jon smiled.  Ben Stark laughed. “As I feared. Ah, well. I believe I was younger than you the first time I got truly and sincerely drunk.”   He snagged a roasted onion, dripping brown with gravy, from a nearby trencher and bit into it. It crunched.  His uncle was sharp-featured and gaunt as a mountain crag, but there was always a hint of laughter in his blue-grey eyes. He dressed in black, as befitted a man of the Night’s Watch. Tonight it was rich black velvet, with high leather boots and a wide belt with a silver buckle. A heavy silver chain was looped round his neck. Benjen watched Ghost with amusement as he ate his onion. “A very quiet wolf,”   he observed.  “  He’s not like the others,”   Jon said. “He never makes a sound. That’s why I named him Ghost. That, and because he’s white. The others are all dark, grey or black.”   “  There are still direwolves beyond the Wall. We hear them on our rangings.”   Benjen Stark gave Jon a long look. “Don’t you usually eat at table with your brothers?”   “  Most times,”   Jon answered in a flat voice. “But tonight Lady Stark thought it might give insult to the royal family to seat a bastard among them.”   “  I see.”   His uncle glanced over his shoulder at the raised table at the far end of the hall. “My brother does not seem very festive tonight.”   Jon had noticed that too. A bastard had to learn to notice things, to read the truth that people hid behind their eyes. His father was observing all the courtesies, but there was tightness in him that Jon had seldo m seen before. He said little, looking out over the hall with hooded eyes, seeingnothing. Two seats away, the king had been drinking heavily all night. His broad face was flushed behind his great black beard. He made many a toast, laughed loudly at every jest, and attacked each dish like a starving man, but beside him the queen seemed as cold as an ice sculpture. “The queen is angry too,”   Jon told his uncle in a low, quiet voice. “Father took the king down to the crypts this afternoon. The queen didn’t want him to go.”   Benjen gave Jon a careful, measuring look. “You don’t miss much, do you, Jon? We could use a man like you on the Wall.”   Jon swelled with pride. “Robb is a stronger lance than I am, but I’m the better sword, and Hullen says I sit a horse as well as anyone in the castle.” 
    “  Notable achievements.”   “  Take me with you when you go back to the Wall,”   Jon said in a sudden rush. “Father will give me leave to go if you ask him, I know he will.”   Uncle Benjen studied his face carefully. “The Wall is a hard place for a boy, Jon.”   “  I am almost a man gr own,”   Jon protested. “I will turn fifteen on my next name day, and Maester Luwin says bastards grow up faster than other children.”   “  That’s true enough,”   Benjen said with a downward twist of his mouth. He took Jon’s cup from the table, filled it fresh from a nearby pitcher, and drank down a long swallow.  “  Daeren Targaryen was only fourteen when he conquered Dorne,”   Jon said. The Young Dragon was one of his heroes.  “  A conquest that lasted a summer,”   his uncle pointed out. “Your Boy King lost ten thousand men taking the place, and another fifty trying to hold it. Someone should have told him that war isn’t a game.”   He took another sip of wine. “Also,”   he said, wiping his mouth, “Daeren Targaryen was only eighteen when he died. Or have you forgotten that part?”   “  I forget nothing,” Jon boasted. The wine was making him bold. He tried to sit very straight, to make himself seem taller. “I want to serve in the Night’s Watch, Uncle.”   He had thought on it long and hard, lying abed at night while his brothers slept around him. Robb would someday inherit Winterfell, would command great armies as the Warden of the North. Bran and Rickon would be Robb’s bannermen and rule holdfasts in his name. His sisters Arya and Sansa would marry the heirs of other great houses and go south as mistress of castles of their own. But what place could a bastard hope to earn?  “  You don’t know what you’re asking, Jon. The Night’s Watch is a sworn brotherhood. We have no families. None of us will ever father sons. Our wife is duty. Our mistress is honor.”   “  A bastard can have honor too,”   Jon said.  “I am ready to swear your oath.”   “  You are a boy of fourteen,”   Benjen said. “Not a man, not yet. Until you have known a woman, you cannot understand what you would be giving up.”   “  I don’t care about that!”   Jon said hotly.  “  You might, if you knew what it meant,”   Benjen said. “If you knew what the oath would cost you, you might be less eager to pay the price, son.”   Jon felt anger rise inside him. “I’m not your son!”   Benjen Stark stood up. “More’s the pit y.”   He put  a hand on Jon’s shoulder. “Come back to me after you’ve fathered a few bastards of your own, and we’ll see how you feel.”   Jon trembled. “I will never father a bastard,”   he said carefully. “Never!”   He spat it out like venom.  Suddenly he realized that the table had fallen silent, and they were all looking at him. He felt the tears begin to well behind his eyes. He pushed himself to his feet.  “  I must be excused,”   he said with the last of his dignity. He whirled and bolted before they could see him cry. He must have drunk more wine than he had realized. His feet got tangled under him as he tried to leave, and he lurched sideways into a serving girl and sent a flagon of spiced wine crashing to the floor. Laughter boomed all around him, and Jon felt hot tears on his 
    cheeks. Someone tried to steady him. He wrenched free of their grip and ran, half-blind, for the door. Ghost followed close at his heels, out into the night.  The yard was quiet and empty. A lone sentry stood high on the battlements of the inner wall, his cloak pulled tight around him against the cold. He looked bored and miserable as he huddled there alone, but Jon would have traded places with him in an instant. Otherwise the castle was dark and deserted. Jon had seen an abandoned holdfast once, a drear place where nothing moved but the wind and the stones kept silent about whatever people had lived there. Winterfell reminded him of that tonight.  The sounds of music and song spilled through the open windows behind him. They were the last things Jon wanted to hear. He wiped away his tears on the sleeve of his shirt, furious that he had let them fall, and turned to go.  “  Bo y,”   a voice called out to him. Jon turned.  Tyrion Lannister was sitting on the ledge above the door to the Great Hall, looking for all the world like a gargoyle. The dwarf grinned down at him. “Is that animal a wolf?”   “  A direwolf,”   Jon said. “His name is Ghost.”   He stared up at the little man, his disappointment suddenly forgotten. “What are you doing up there? Why aren’t you at the feast?”   “  Too hot, too noisy, and I’d drunk too much wine,”   the dwarf told him. “I learned long ago that it is considered rude to vomit on your brother. Might I have a closer look at your wolf?”   Jon hesitated, then nodded slowly. “Can you climb down, or shall I bring a ladder?”   “  Oh, bleed that,”   the little man said. He pushed himself off the ledge into empty air. Jon gasped, then watched with awe as Tyrion Lannister spun around in a tight ball, landed lightly on his hands, then vaulted backward onto his legs.  Ghost backed away from him uncertainly.  The dwarf dusted himself off and laughed. “I believe I’ve frightened your wolf. My apologies.”   “  He’s not scared,”   Jon said. He knelt and called out. “Ghost, come here. Come on. That’s it.”   The wolf pup padded closer and nuzzled at Jon’s face, but he kept a wary eye on Tyrion Lannister, and when the dwarf reached out to pet him, he drew back and bared his fangs in a silent snarl. “Shy, isn’t he?”   Lannister observed.  “  Sit, Ghost,”   Jon commanded. “That’s it. Keep still.”   He looked up at the dwarf. “You can touch him now. He won’t move unt il I tell hi m to. I’ve been training him.”   “  I see,”   Lannister said. He ruffled the snow-white fur between Ghost’s ears and said, “Nice wolf.”   “  If I wasn’t here, he’d tear out your throat,”   Jon said. It wasn’t actually true yet, but it would be.  “  In that case, you had best stay close,”   the dwarf said. He cocked his oversized head to one side and looked Jon over with his mismatched eyes. “I am Tyrio n Lanni ster.”   “  I know,”   Jon said. He rose. Standing, he was taller than the dwarf. It made him feel strange.  “  You’re Ned Stark’s bastard, aren’t you?”   Jon felt a coldness pass right through him. He pressed his lips together and said nothing.
    “  Did I offend you?”   Lannister said. “Sorry. Dwarfs don’t have to be tactful. Generations of capering fools in motley have won me the right to dress badly and say any damn thing that comes into my head.”   He grinned. “You are the bastard, though.”   “  Lord Eddard Stark is my father,”   Jon admitted stiffly.  Lannister studied his face. “Yes,”   he said. “I can see it. You have more of the north in you than your brothers.”   “  Half brothers,”   Jon corrected. He was pleased by the dwarf s comment, but he tried not to let it show.  “  Let me give you some counsel, bastard,”   Lannister said. “Never forget what you are, for surely the world will not. Make it your strength. Then it can never be your weakness. Armor yourself in it, and it will never be used to hurt you.”   Jon was in no mood for anyone’s counsel. “What do you know about being a bastard?”   “  All dwarfs are bastards in their father’s eyes.”   “  You are your mother’s trueborn son of Lannister.”   “  Am I”   the dwarf replied, sardonic. “Do tell my lord father. MY mother died birthing me, and he’s never been sure.”   “  I don’t even know who my mother was,”   Jon said.  “  Some woman, no doubt. Most of them are.”   He favored Jon with a rue ful gr in. “Remember this, boy. All dwarfs may be bastards, yet not all bastards need be dwarfs.”   And with that he turned and sauntered back into the feast, whistling a tune. When he opened the door, the light from within threw his shadow clear across the yard, and for just a moment Tyrion Lannister stood tall as a king.
    """
    
    passage2 = """
    Jon climbed the steps slowly, trying not to think that this might be the last time ever. Ghost padded silently beside him. Outside, snow swirled through the castle gates, and the yard was all noise and chaos, but inside the thick stone walls it was still warm and quiet. Too quiet for Jon’s liking.   He reached the landing and stood for a long moment, afraid. Ghost nuzzled at his hand. He took courage from that. He straightened, and entered the room.  Lady Stark was there beside his bed. She had been there, day and night, for close on a fortnight. Not for a moment had she left Bran’s side. She had her meals brought to her there, and chamber pots as well, and a small hard bed to sleep on, though it was said she had scarcely slept at all. She fed him herself, the honey and water and herb mixture that sustained life. Not once did she leave the room. So Jon had stayed away.  But now there was no more time.  He stood in the door for a moment, afraid to speak, afraid to come closer. The window was open. Below, a wolf howled. Ghost heard and lifted his head.Lady Stark looked over. For a moment she did not seem to recognize him. Finally she blinked. “What are you doing here?”   she asked in a voice strangely flat and emotionless.  “  I came to see Bran,”   Jon said. “To say good-bye.”   Her face did not change. Her long auburn hair was dull and tangled. She looked as though she had aged twenty years. “You’ve said it. Now go away.”   Part of him wanted only to flee, but he knew that if he did he might never see Bran again. He took a nervous step into the room. “Please,”   he said.  Something cold moved in her eyes. “I told you to leave,”   she said. “We don’t want you here.”   Once that would have sent him running. Once that might even have made him cry. Now it only made him angry. He would be a Sworn Brother of the Night’s Watch soon, and face worse dangers than Catelyn Tully Stark. “He’s my brother,”   he said.  “  Shall I call the guards?”   “  Call them,”   Jon said, defiant. “You can’t stop me from seeing him.”   He crossed the room, keeping the bed between them, and looked down on Bran where he lay.  She was holding one of his hands. It looked like a claw. This was not the Bran he remembered. The flesh had all gone from him. His skin stretched tight over bones like sticks. Under the blanket, his legs bent in ways that made Jon sick. His eyes were sunken deep into black pits; open, but they saw nothing. The fall had shrunken him somehow. He looked half a leaf, as if the first strong wind would carry him off to his grave.  Yet under the frail cage of those shattered ribs, his chest rose and fell with each shallow breath.  “  Bran,”   he said, “I’m sorry I didn’t come before. I was afraid.”   He could feel the tears rolling down his cheeks. Jon no longer cared. “Don’t die, Bran. Please. We’re all waiting for you to wake up. Me and Robb and the girls, everyone...” 
    Lady Stark was watching. She had not raised a cry. Jon took that for acceptance. Outside the window, the direwolf howled again. The wolf that Bran had not had time to name.  “  I have to go now,”   Jon said. “Uncle Benjen is waiting. I’m to go north to the Wall. We have to leave today, before the snows come.”   He remembered how excited Bran had been at the prospect of the journey. It was more than he could bear, the thought of leaving him behind like this. Jon brushed away his tears, leaned over, and kissed his brother lightly on the lips.  “  I wanted him to stay here with me,”   Lady Stark said soft ly.  Jon watched her, wary. She was not even looking at him. She was talking to him, but for a part of her, it was as though he were not even in the room.  “  I prayed for it,”   she said dully. “He was my special boy. I went to the sept and prayed seven times to the seven faces of god that Ned would change his mind and leave him here with me. Sometimes prayers are answered.”   Jon did not know what to say. “It wasn’t your fault,”   he managed after an awkward silence.  Her eyes found him. They were full of poison. “I need none of your absolut ion, bastard.”   Jon lowered his eyes. She was cradling one of Bran’s hands. He took the other, squeezed it. Fingers like the bones of birds. “Good-bye,”   he said.  He was at the door when she called out to him. “Jon,”   she said. He should have kept going, but she had never called him by his name before. He turned to find her looking at his face, as if she were seeing it for the first time.  “  Yes?”   he said.  “  It should have been you,”   she told him. Then she turned back to Bran and began to weep, her whole body shaking with the sobs. Jon had never seen her cry before.  It was a long walk down to the yard.  Outside, everything was noise and confusion. Wagons were being loaded, men were shouting, horses were being harnessed and saddled and led from the stables. A light snow had begun to fall, and everyone was in an uproar to be off.  Robb was in the middle of it, shouting commands with the best of them. He seemed to have grown of late, as if Bran’s fall and his mother’s collapse had somehow made him stronger. Grey Wind was at his side.  “  Uncle Benjen is looking for you,”   he told Jon. “He wanted to be gone an hour ago.”   “  I know,”   Jon said.  “Soon.”   He looked around at all the noise and confusion. “Leaving is harder than I thought.”   “  For me too,”   Robb said. He had snow in his hair, melting from the heat of his body. “Did you see him?”   Jon nodded, not trusting himself to speak.  “  He’s not going to die,”   Robb said. “I know it.”   “  You Starks are hard to kill,”   Jon agreed. His voice was flat and tired. The visit had taken all the strength from him.  Robb knew something was wrong. “My mother... “   “  She was... very kind,”   Jon told hi m.
    Robb looked relieved. “Good.”   He smiled. “The next time I see you, you’ll be all in black.”   Jon forced himself to smile back. “It was always my color. How long do you think it will be?”   “  Soon enough,”   Robb promised. He pulled Jon to him and embraced him fiercely. “Farewell, Snow.”   Jon hugged him back. “And you, Stark. Take care of Bran.”   “  I will.”   They broke apart and looked at each other awkwardly. “Uncle Benjen said to send you to the stables if I saw you,”   Robb fina lly said.  “  I have one more farewell to make,”   Jon told him.  “  Then I haven’t seen you,”   Robb replied. Jon left him standing there in the snow, surrounded by wagons and wolves and horses. It was a short walk to the armory. He picked up his package and took the covered bridge across to the Keep.  Arya was in her room, packing a polished ironwood chest that was bigger than she was. Nymeria was helping. Arya would only have to point, and the wolf would bound across the room, snatch up some wisp of silk in her jaws, and fetch it back. But when she smelled Ghost, she sat down on her haunches and yelped at them.  Arya glanced behind her, saw Jon, and jumped to her feet. She threw her skinny arms tightaround his neck. “I was afraid you were gone,”   she said, her breath catching in her throat. “They wouldn’t let me out to say good-bye.”   “  What did you do now?”   Jon was amused.  Arya disentangled herself from him and made a face. “Nothing. I was all packed and everything.” She gestured at the huge chest, no more than a third full, and at the clothes that were scattered all over the room. “Septa Mordane says I have to do it all over. My things weren’t properly folded, she says. A proper southron lady doesn’t just throw her clothes inside her chest like old rags, she says.”   “  Is that what you did, little sister?”   “  Well, they’re going to get all messed up anyway,”   she said. “Who cares how they’re folded?”   “  Septa Mordane,”   Jon told her. “I don’t think she’d like Nymeria helping, either.”   The she-wolf regarded him silently with her dark golden eyes. “It’s just as well. I have something for you to take with you, and it has to be packed very carefully.”   Her face lit up. “A present?”   “  You could call it that. Close the door.”   Wary but excited, Arya checked the hall. “Nymeria, here. Guard.”   She left the wolf out there to warn of intruders and closed the door. By then Jon had pulled off the rags he’d wrapped it in. He held it out to her.  Arya’s eyes went wide. Dark eyes, like his. “A sword,”   she said in a small, hushed breath.  The scabbard was soft grey leather, supple as sin. Jon drew out the blade slowly, so she could see the deep blue sheen of the steel. “This is no toy,”   he told her. “Be careful you don’t cut yourself. The edges are sharp enough to shave with.”   “  Girls do n’t shave,”   Arya said.  “  Maybe they should. Have you ever seen the septa’s legs?” 
    She giggled at him. “It’s so skinny.”   “  So are you,”   Jon told her. “I had Mikken make this special. The bravos use swords like this in Pentos and Myr and the other Free Cities. It won’t hack a man’s head off, but it can poke him full of holes if you’re fast enough.”   “  I can be fast,”   Arya said.  “  You’ll have to work at it every day.”   He put  the sword in her hands, showed her how to hold it, and stepped back. “How does it feel? Do you like the balance?”   “  I think so,”   Arya said.  “  First lesson,”   Jon said. “Stick them with the pointy end.”   Arya gave him a whap on the arm with the flat of her blade. The blow stung, but Jon found himself grinning like an idiot. “I know which end to use,”   Arya said. A doubtful look crossed her face. “Septa Mordane will take it away from me.”   “  Not if she doesn’t know you have it,”   Jon said.  “  Who will I practice with?”   “  You’ll find  so meone,”   Jon promised her. “King’s Landing is a true city, a thousand times the size of Winterfell. Until you find a partner, watch how they fight in the yard. Run, and ride, make yourself strong. And whatever you do...”   Arya knew what was coming next. They said it together.  “Don’t ...  tell... Sansa!”   Jon messed up her hair. “I will miss you, little sister.”   Suddenly she looked like she was going to cry. “I wish you were coming with us.”   “  Different roads sometimes lead to the same castle. Who knows?”   He was feeling better now. He was not going to let himself be sad. “I better go. I’ll spend my first year on the Wall emptying chamber pots if I keep Uncle Ben waiting any longer.”   Arya ran to him for a last hug. “Put down the sword first,”   Jon warned her, laughing. She set it aside almost shyly and showered him with kisses.  When he turned back at the door , she was holding it again, trying it for balance. “I almost forgot,” he told her. “All the best swords have names.”   “  Like Ice,”   she said. She looked at the blade in her hand. “Does this have a name? Oh, tell me.”   “  Can’t you guess?”   Jon teased. “Your very favorite thing.”   Arya seemed puzzled at first. Then it came to her. She was that quick. They said it together:  “  Needle!”   The memory of her laughter warmed him on the long ride north.
    """
    
    passage3 = """
    Mormont grumbled. “That’s all they’re good for, ravens. Why I put up with that pestilent ial bird... if there was news of Lord Eddard, don’t you think I would have sent for you? Bastard or no, you’re still his blood. The message concerned Ser Barristan Selmy. It seems he’s been removed from the Kingsguard. They gave his place to that black dog Clegane, and now Selmy’s wanted for treason. The fools sent some watchmen to seize him, but he slew two of them and escaped.”     Mormont snorted, leaving no doubt of his view of men who’d send gold cloaks against a knight as renowed as Barristan the Bold. “We have white shadows in the woods and unquiet dead stalking our halls, and a boy sits the Iron Throne,”   he said in disgust.  The raven laughed shrilly. “Bo y, bo y, bo y, bo y.”   Ser Barristan had been the Old Bear’s best hope, Jon remembered; if he had fallen, what chance was there that Mormont’s letter would be heeded? He curled his hand into a fist. Pain shot through his burned fingers. “What of my sisters?”   “  The message made no mention of Lord Eddard or the girls.”   He gave an irritated shrug. “Perhaps they never got my letter. Aemon sent two copies, with his best birds, but who can say? More like, Pycelle did not deign to reply. It would not be the first time, nor the last. I fear we count for less than nothing in King’s Landing. They tell us what they want us to know, and that’s little enough.”   And you tell me what you want me to know, and that’s less, Jon thought resentfully. His brother Robb had called the banners and ridde n south to war, yet no word of that had been breathed to him... save by Samwell Tarly, who’d read the letter to Maester Aemon and whispered its contents to Jon that night in secret, all the time saying how he shouldn’t. Doubtless they thought his brother’s war was none of his concern. It troubled him more than he could say. Robb was marching and he was not. No matter how often Jon told himself that his place was here now, with his new brothers on the Wall, he still felt craven.  “  Corn, “   the raven was crying. “Corn, corn. “   “  Oh, be quiet,”   the Old Bear told it. “Snow, how soon does Maester Aemon say you’ll have use of that hand back?”   “  Soon,”   Jon replied.  “Good.” On the table between them, Lord Mormont laid a large sword in a black metal scabbard banded with silver. “Here. You’ll be ready for this, then.”   The raven flapped down and landed on the table, strutting toward the sword, head cocked curiously. Jon hesitated. He had no inkling what this meant. “My lord?”   “  The fire melted the silver off the pommel and burnt the crossguard and grip. Well, dry leatherand old wood, what could you expect? The blade, now... you’d need a fire a hundred times as hot to harm the blade.”   Mormont shoved the scabbard across the rough oak planks. “I had the rest made anew. Take it.”   “  Take it, “ echoed his raven, preening. “Take it, take it.”   Awkwardly, Jon took the sword in hand. His left hand; his bandaged right was still too raw and clumsy. Carefully he pulled it from its scabbard and raised it level with his eyes.
    The pommel was a hunk of pale stone weighted with lead to balance the long blade. It had been carved into the likeness of a snarling wolf’s head, with chips of garnet set into the eyes. The grip was virgin leather, soft and black, as yet unstained by sweat or blood. The blade itself was a good half foot longer than those Jon was used to, tapered to thrust as well as slash, with three fullers deeply incised in the metal. Where Ice was a true two-handed greatsword, this was a hand-and-a-halfer, sometimes named a “bastard sword.”   Yet the wolf sword actually seemed lighter than the blades he had wielded before. When Jon turned it sideways, he could see the ripples in the dark steel where the metal had been folded back on itself again and again. “This is Valyrian steel, my lord,”   he said wonderingly. His father had let him handle Ice often enough; he knew the look, the feel.  “  It is,”   the Old Bear told hi m. “It was my father’s sword, and his father’s before him. The Mormonts have carried it for five centuries. I wielded it in my day and passed it on to my son when I took the black.”   He is giving me his son’s sword. Jon could scarcely believe it. The blade was exquisitely balanced. The edges glimmered faintly as they kissed the light. “Your son-”   “  My son brought dishonor to House Mormont, but at least he had the grace to leave the sword behind when he fled. My sister returned it to my keeping, but the very sight of it reminded me of Jorah’s shame, so I put it aside and thought no more of it until we found it in the ashes of my bedchamber. The original po mmel was a bear’s head, silver, yet so worn its features were all but indistinguishable. For you, I thought a white wolf more apt. One of our builders is a fair stonecarver.”   When Jon had been Bran’s age, he had dreamed of doing great deeds, as boys always did. The details of his feats changed with every dreaming, but quite often he imagined saving his father’s life. Afterward Lord Eddard would declare that Jon had proved himself a true Stark, and place Ice in his hand. Even then he had known it was only a child’s folly; no bastard could ever hope to wield a father’s sword. Even the memory shamed him. What kind of man stole his own brother’s birthright? I have no right to this, he thought, no more than to ke. He twitched his burned fingers, feeling a throb of pain deep under the skin. “My lord, you honor me, but-”   “  Spare me your but’s, boy,”   Lord Mormont interrupted. “I would not be sitting here were it not for you and that beast of yours. You fought bravely... and more to the point, you thought quickly. Fire! Yes, damn it. We ought to have known. We ought to have remembered. The Long Night has come before. Oh, eight thousand years is a good while, to be sure... yet if the Night’s Watch does not remember, who will?”   “  Who will, “   chimed the talkative raven. “Who will.”   Truly, the gods had heard Jon’s prayer that night; the fire had caught in the dead man’s clothing and consumed him as if his flesh were candle wax and his bones old dry wood. Jon had only to close his eyes to see the thing staggering across the solar, crashing against the furniture and flailing at the flames. It was the face that haunted him most; surrounded by a nimbus of fire, hair blazing like straw, the dead flesh melting away and sloughing off its skull to reveal the gleam of bone beneath.
    Whatever demonic force moved Othor had been driven out by the flames; the twisted thing they had found in the ashes had been no more than cooked meat and charred bone. Yet in his nightmare he faced it again... and this time the burning corpse wore Lord Eddard’s features. It was his father’s skin that burst and blackened, his father’s eyes that ran liquid down his cheeks like jellied tears. Jon did not understand why that should be or what it might mean, but it frightened him more than he could say.  “  A sword’s small payment for a life,”   Mormont concluded. “Take it, I’ll hear no more of it, is that understood?”   “  Yes, my lord.”   The soft leather gave beneath Jon’s fingers, as if the sword were molding itself to his grip already. He knew he should be honored, and he was, and yet...   He is not my father. The thought leapt unbidden to Jon’s mind. Lord Eddard Stark is my father. I will not forget him, no matter how many swords they give me. Yet he could scarcely tell Lord Mormont that it was another man’s sword he dreamt of...   “  I want no courtesies either,”   Mormont said,  “so thank me no thanks. Honor the steel with deeds, not words.”   Jon nodded. “Does it have a name, my lord?”   “  It did, once. Longclaw, it was called.”   “  Claw, “   the raven cried. “Claw. “   “  Longclaw is an apt name.”   Jon tried a practice cut. He was clumsy and uncomfortable with his left hand, yet even so the steel seemed to flow through the air, as if it had a will of its own. “Wolves have claws, as much as bears.”   The Old Bear seemed pleased by that. “I suppose they do. You’ll want to wear that over the shoulder, I imagine. It’s too long for the hip, at least until you’ve put  on a few inches. And you’ll need to work at your two-handed strikes as well. Ser Endrew can show you some moves, when your burns have healed.”   “  Ser Endrew?”   Jon did not know the name.  “  Ser Endrew Tarth, a good man. He’s on his way from the Shadow Tower to assume the duties of master-at-arms. Ser Alliser Thorne left yestermorn for Eastwatch-by-the-Sea.”   Jon lowered the sword. “Why?”   he said, stupidly.  Mormont snorted. “Because I sent him, why do you think? He’s    bringing the hand your Ghost tore off the end of Jafer Flowers’s wrist. I have commanded him to take ship to King’s Landing and lay it before this boy king. That should get young Joffrey’s attention, I’d think... and Ser Alliser’s a knight, highborn, anointed, with old friends at court, altogether harder to ignore than a glorified crow.”   “  Crow. “   Jon thought the raven sounded faintly indignant.  “  As well,”   the Lord Commander continued, ignoring the bird’s protest, “it puts a thousand leagues twixt him and you without it seeming a rebuke.”   He jabbed a finger up at Jon’s face. “And don’t think this means I approve of that nonsense in the common hall. Valor makes up for a fair amount of folly, but you’re not a boy anymore, however many years you’ve seen. That’s a 
    man’s sword you have there, and it will take a man to wield her. I’ll expect you to act the part, henceforth.”   “  Yes, my lord.”   Jon slid the sword back into the silver-banded scabbard. If not the blade he would have chosen, it was nonetheless a noble gift, and freeing him from Alliser Thorne’s malignance was nobler still.  The Old Bear scratched at his chin. “I had forgotten how much a new beard itches,”   he said. “Well, no help for that. Is that hand of yours healed enough to resume your duties?”   “  Yes, my lord.”   “  Good. The night will be cold, I’ll want hot spice wine. Find me a flagon of red, not too sour, and don’t skimp on the spices. And tell Hobb that if he sends me boiled mutton again I’m like to boil him. That last haunch was grey. Even the bird wouldn’t touch it.”   He stroked the raven’s head with his thumb, and the bird made a contented quorking sound. “Away wit h you.  I’ve work to do.”   The guards smiled at him from their niches as he wound his way down the turret stair, carrying the sword in his goo d hand. “Sweet steel,”   one man said. “You earned that, Snow,”   another told him. Jon made himself smile back at them, but his heart was not in it. He knew he should be pleased, yet he did not feel it. His hand ached, and the taste of anger was in his mouth, though he could not have said who he was angry with or why.  A half dozen of his friends were lurking outside when he left the King’s Tower, where Lord Commander Mormont now made his residence. They’d hung a target on the granary doors, so they could seem to be honing their skills as archers, but he knew lurkers when he saw them. No sooner did he emerge than Pyp called out, “Well, come about, let   ’s have a look.”   “  At what?”   Jon said.  Toad sidled close. “Your rosy butt cheeks, what else?”   “  The sword,”   Grenn stated. “We want to see the sword.”   Jon raked them with an accusing look. “You knew.”   Pyp grinned. “We’re not all as dumb as Grenn.”   “  You are so,”   insisted Grenn. “You’re dumber.”   Halder gave an apologetic shrug. “I helped Pate carve the stone for the pommel,”   the builder said, “and your friend Sam bought the garnets in Mole’s Town.”   “  We knew even before that, though,”   Grenn said. “Rudge  has been helping Donal Noye in the forge. He was there when the Old Bear brought him the burnt blade.”   “  The sword!”   Matt insisted. The others took up the chant. “The sword, the sword, the sword.”   Jon unsheathed Longclaw and showed it to them, turning it this way and that so they could admire it. The bastard blade glittered in the pale sunlight, dark and deadly. “Valyrian steel,”   he declared solemnly, trying to sound as pleased and proud as he ought to have felt.  “  I heard of a man who had a razor made of Valyrian steel,”   declared Toad. “He cut his head off trying to shave.”   Pyp grinned. “The Night’s Watch is thousands of years old,”   he said, “but I’ll wager Lord Snow’s the first brother ever honored for burning down the Lord Commander’s Tower.” 
    The others laughed, and even Jon had to smile. The fire he’d started had not, in truth, burned down that formidable stone tower, but it had done a fair job of gutting the interior of the top two floors, where the Old Bear had his chambers. No one seemed to mind that very much, since it had also destroyed Othor’s murderous corpse.  The other wight, the one-handed thing that had once been a ranger named Jafer Flowers, had also been destroyed, cut near to pieces by a dozen swords...  but not before it had slain Ser Jaremy Rykker and four other men. Ser Jaremy had finished the job of hacking its head off, yet had died all the same when the headless corpse pulled his own dagger from its sheath and buried it in his bowels. Strength and courage did not avail much against foemen who would not fall because they were already dead; even arms and armor offered small protection.  That grim thought soured Jon’s fragile mood. “I need to see Hobb about the Old Bear’s supper,” he announced brusquely, sliding Longclaw back into its scabbard. His friends meant well, but they did not understand. It was not their fault, truly; they had not had to face Othor, they had not seen the pale glow of those dead blue eyes, had not felt the cold of those dead black fingers. Nor did they know of the fighting in the riverlands. How could they hope to comprehend? He turned away from them abruptly and strode off, sullen. Pyp called after him, but Jon paid him no mind.  They had moved him back to his old cell in tumbledown Hardin’s Tower after the fire, and it was there he returned. Ghost was curled up asleep beside the door, but he lifted his head at the sound of Jon’s boots. The direwolf’s red eyes were darker than garnets and wiser than men. Jon knelt, scratched his ear, and showed him the pommel of the sword. “Look. It’s you.”   Ghost sniffed at his carved stone likeness and tried a lick. Jon smiled. “You’re the one deserves an honor,”   he told the wolf... and suddenly he found himself remembering how he’d found him, that day in the late summer snow. They had been riding off with the other pups, but Jon had heard a noise and turned back, and there he was, white fur almost invisible against the drifts. He was all alone, he thought, apart from the others in the litter. He was different, so they drove him out.  “  Jon?”   He looked up. Samwell Tarly stood rocking nervously on his heels. His cheeks were red, and he was wrapped in a heavy fur cloak that made him look ready for hibernation.  “  Sam.”   Jon stood. “What is it? Do you want to see the sword?”   If the others had known, no doubt Sam did too.  The fat boy shook his head. “I was heir to my father’s blade once,”   he said mournfully.  “Heartsbane. Lord Randyll let me hold it a few times, but it always scared me. It was Valyrian steel, beautiful but so sharp I was afraid I’d hurt one of my sisters. Dickon will have it now.”   He wiped sweaty hands on his cloak. “I ah... Maester Aemon wants to see you.”   It was not time for his bandages to be changed. Jon frowned suspiciously. “Why?”   he demanded. Sam looked miserable. That was answer enough. “You told him, didn’t you?”   Jon said angrily. “You told him that you told me.”   “I...  he... Jon, I didn’t want to...    he asked... I mean I think he knew, he sees things no one else sees...” 
    “  He’s blind,”   Jon pointed out forcefully, disgusted. “I can find the way myself.”   He left Sam standing there, openmouthed and quivering.  He found Maester Aemon up in the rookery, feeding the ravens. Clydas was with him, carrying a bucket of chopped meat as they shuffled from cage to cage. “Sam said you wanted me?”   The maester nodded. “I did indeed. Clydas, give Jon the bucket. Perhaps he will be kind enough to assist me.”   The hunched, pink-eyed brother handed Jon the bucket and scurried down the ladder. “Toss the meat into the cages,”   Aemon instructed him. “The birds will do the rest. “   Jon shifted the bucket to his right hand and thrust his left down into the bloody bits. The ravens began to scream noisily and fly at the bars, beating at the metal with night-black wings. The meat had been chopped into pieces no larger than a finger joint. He filled his fist and tossed the raw red morsels into the cage, and the squawking and squabbling grew hotter. Feathers flew as two of the larger birds fought over a choice piece. Quickly Jon grabbed a second handful and threw it in after the first. “Lord Mormont’s raven likes fruit and corn.”   “  He is a rare bird,”   the maester said. “Most ravens will eat grain, but they prefer flesh. It makes them strong, and I fear they relish the taste of blood. In that they are like men... and like men, not all ravens are alike.”   Jon had nothing to say to that. He threw meat, wondering why he’d been summoned. No doubt the old man would tell him, in his own good time. Maester Aemon was not a man to be hurried.“Doves and pigeons can also be trained to carry messages,”   the maester went on, “though the raven is a stronger flyer, larger, bolder, far more clever, better able to defend itself against hawks... yet ravens are black, and they eat the dead, so some godly men abhor them. Baelor the Blessed tried to replace all the ravens with doves, did you know?”   The maester turned his white eyes on Jon, smiling. “The Night’s Watch prefers ravens.”   Jon’s fingers were in the bucket, blood up to the wrist. “Dywen says the wildlings call us crows,”   he said uncertainty.  “  The crow is the raven’s poor cousin. They are both beggars in black, hated and misunderstood.”   Jon wished he understood what they were talking about, and why. What did he care about ravens and doves? If the old man had something to say to him, why couldn’t he just say it?  “  Jon, did you ever wonder why the men of the Night’s Watch take no wives and father no children?” Maester Aemon asked.  Jon shrugged. “No.”   He scattered more meat. The fingers of his left hand were slimy with blood, and his right throbbed from the weight of the bucket.  “  So they will not love,”   the old man answered, “for love is the bane of honor, the death of duty.”   That did not sound right to Jon, yet he said nothing. The maester was a hundred years old, and a high officer of the Night’s Watch; it was not his place to contradict him.  The old man seemed to sense his doubts. “Tell me, Jon, if the day should ever come when your lord father must needs choose between honor on the one hand and those he loves on the other, what would he do?” 
    Jon hesitated. He wanted to say that Lord Eddard would never dishonor himself, not even for love, yet inside a small sly voice whispered, He fathered a bastard, where was the honor in that? And your mother, what of his duty to her, he will not even say her name. “He would do whatever was right,”   he said... ringingly, to make up for his hesitation. “No matter what.”   “  Then Lord Eddard is a man in ten thousand. Most of us are not so strong. What is honor compared to a woman’s love? What is dut y against the feel of a newborn son in your arms... or the memory of a brother’s smile? Wind and words. Wind and words. We are only human, and the gods have fashioned us for love. That is our great glory, and our great tragedy.  “  The men who formed the Night’s Watch knew that only their courage shielded the realm from the darkness to the north. They knew they must have no divided loyalties to weaken their resolve. So they vowed they would have no wives nor children.  “  Yet brothers they had, and sisters. Mothers who gave them birth, fathers who gave them names. They came from a hundred quarrelsome kingdo ms, and they knew times may change, but men do not. So they pledged as well that the Night’s Watch would take no part in the battles of the realms it guarded.  “  They kept their pledge. When Aegon slew Black Harren and claimed his kingdom, Harren’s brother was Lord Commander on the Wall, with ten thousand swords to hand. He did not march. In the days when the Seven Kingdoms were seven kingdoms, not a generation passed that three or four of them were not at war. The Watch took no part. When the Andals crossed the narrow sea and swept away the kingdoms of the First Men, the sons of the fallen kings held true to their vows and remained at their posts. So it has always been, for years beyond counting. Such is the price of honor.  “  A craven can be as brave as any man, when there is nothing to fear. And we all do our duty, when there is no cost to it. How easy it seems then, to walk the path of honor. Yet soon or late in every man’s life comes a day when it is not easy, a day when he must choose.”   Some of the ravens were still eating, long stringy bits of meat dangling from their beaks. The rest seemed to be watching him. Jon could feel the weight of all those tiny black eyes. “And this is my da y... is that what you’re saying?”   Maester Aemon turned his head and looked at him with those dead white eyes. It was as if he were seeing right into his heart. Jon felt naked and exposed. He took the bucket in both hands and flung the rest of the slops through the bars. Strings of meat and blood flew everywhere, scattering the ravens. They took to the air, shrieking wildly. The quicker birds snatched morsels on the wing and gulped them down greedily. Jon let the empty bucket clang to the floor.  The old man laid a withered, spotted hand on his shoulder. “It hurts, boy,”   he said softly. “Oh, yes. Choosing... it has always hurt. And always will. I know.”   “  You don’t know,”   Jon said bitterly. “No one knows. Even if I am his bastard, he’s still my father...”   Maester Aemon sighed. “Have you heard nothing I’ve told you, Jon? Do you think you are the first?”   He shook his ancient head, a gesture weary beyond words. “Three times the gods saw fit to test my vows. Once when I was a boy, once in the fullness of my manhood, and once when I 
    had grown old. By then my strength was fled, my eyes grown dim, yet that last choice was as cruel as the first. My ravens would bring the news from the south, words darker than their wings, the ruin of my House, the death of my kin, disgrace and desolation. What could I have done, old, blind, frail? I was helpless as a suckling babe, yet still it grieved me to sit forgotten as they cut down my brother’s poor grandson, and his son, and even the little children...”   Jon was shocked to see the shine of tears in the old man’s eyes. “Who are you?”   he asked quietly, almost in dread.  A toothless smile quivered on the ancient lips. “Only a maester of the Citadel, bound in service to Castle Black and the Night’s Watch. In my order, we put aside our house names when we take our vows and don the collar.”   The old man touched the maester’s chain that hung loosely around his thin, fleshless neck. “My father was Maekar, the First of his Name, and my brother Aegon reigned after him in my stead. My grandfather named me for Prince Aemon the Dragonknight, who was his uncle, or his father, depending on which tale you believe. Aemon, he called me...”   “  Aemo n... Targaryen?”   Jon could scarcely believe it.  “  Once,”   the old man said. “Once. So you see, Jon, I do know...  and knowing, I will not tell you stay or go. You must make that choice yourself, and live wit h it all the rest of your  da ys. As I have.”   His voice fell to a whisper. “As I have...”
    """
    
    char.update([passage1, passage2])
    print(json.dumps(char.update([passage3]), indent=4))